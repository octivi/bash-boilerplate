#!/usr/bin/env bash
# shellcheck shell=bash

# >>> OBB:BEGIN variant=header source=local version=local
################################################################################
# Octivi Bash Boilerplate (OBB) Header
# Part of Octivi Bash Boilerplate https://github.com/octivi/bash-boilerplate
################################################################################
# Unofficial Bash "Strict Mode"
# http://redsymbol.net/articles/unofficial-bash-strict-mode/
set -euo pipefail
# Define common constants regardless if they are used in the script
__my_name="$(basename "${BASH_SOURCE[0]}")"
readonly __my_name
__my_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
readonly __my_dir
__my_path="${__my_dir}/${__my_name}"
# shellcheck disable=SC2034
readonly __my_path
__my_args="$*"
# shellcheck disable=SC2034
readonly __my_args
# Set IFS to just newline and tab
IFS=$'\n\t'
################################################################################
# <<< OBB:END

VERBOSE=0
NAME=""

usage() {
  cat <<EOF
Usage:
  ${__my_name} -n <name> [-v] [-h]

Options:
  -n <name>  Required name value.
  -v         Verbose logging.
  -h         Show this help.
EOF
}

error() {
  printf 'ERROR: %s\n' "$*" >&2
}

parse_args() {
  local opt
  while getopts ":n:vh" opt; do
    case "${opt}" in
      n) NAME="${OPTARG}" ;;
      v) VERBOSE=1 ;;
      h)
        usage
        exit 0
        ;;
      :)
        error "Option -${OPTARG} requires an argument."
        exit 2
        ;;
      \?)
        error "Unknown option: -${OPTARG}"
        exit 2
        ;;
    esac
  done
  shift $((OPTIND - 1))

  if [[ -z "${NAME}" ]]; then
    error "Missing required option: -n <name>"
    exit 2
  fi

  if (($# > 0)); then
    error "Unexpected positional arguments: $*"
    exit 2
  fi
}

main() {
  parse_args "$@"
  if (( VERBOSE == 1 )); then
    printf 'INFO: running %s\n' "${__my_name}"
  fi
  printf 'Hello %s\n' "${NAME}"
}

main "$@"
